<!DOCTYPE html>
<html>
<head>
    <title>Tactile-JS Safe Refactor - Test Environment</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .canvas-container { display: inline-block; margin: 10px; text-align: center; }
        canvas { border: 1px solid #333; }
        .controls { margin: 10px 0; }
        button { margin: 5px; padding: 8px 15px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .info { background: #f8f9fa; padding: 10px; border-radius: 3px; }
        .log { background: #f5f5f5; padding: 10px; border-radius: 3px; font-family: monospace; max-height: 200px; overflow-y: auto; }
        .tiling-info { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .parameter-display { font-family: monospace; background: #f0f0f0; padding: 5px; }
    </style>
</head>
<body>
    <h1>Tactile-JS Safe Refactor - Test Environment</h1>
    
    <div class="test-section">
        <h2>Original Behavior Documentation</h2>
        <p>This environment allows us to test and document the exact behavior of each tiling type before making any changes.</p>
        
        <div class="controls">
            <label for="tilingType">Tiling Type:</label>
            <input type="number" id="tilingType" value="1" min="1" max="37" style="width: 60px;">
            <button onclick="testSpecificType()">Test This Type</button>
            <button onclick="testAllTypes()">Test All Types (1-37)</button>
            <button onclick="clearLog()">Clear Log</button>
            <button onclick="startServer()">Start Test Server</button>
        </div>
    </div>
    
    <div class="test-section">
        <h3>Current Tiling Display</h3>
        <div class="canvas-container">
            <canvas id="testCanvas" width="400" height="300"></canvas>
            <br>
            <span id="canvasInfo">Tiling Type: 1</span>
        </div>
    </div>
    
    <div class="test-section">
        <h3>Tiling Information</h3>
        <div class="tiling-info">
            <div>
                <h4>Basic Properties</h4>
                <div id="basicInfo" class="info">
                    <p><strong>Type:</strong> <span id="typeDisplay">1</span></p>
                    <p><strong>Vertices:</strong> <span id="verticesDisplay">-</span></p>
                    <p><strong>Aspects:</strong> <span id="aspectsDisplay">-</span></p>
                    <p><strong>Edge Shapes:</strong> <span id="edgeShapesDisplay">-</span></p>
                </div>
            </div>
            <div>
                <h4>Parameters & Translations</h4>
                <div id="paramInfo" class="info">
                    <p><strong>Parameters:</strong> <span id="paramsDisplay" class="parameter-display">-</span></p>
                    <p><strong>T1:</strong> <span id="t1Display" class="parameter-display">-</span></p>
                    <p><strong>T2:</strong> <span id="t2Display" class="parameter-display">-</span></p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="test-section">
        <h3>Test Log</h3>
        <div id="testLog" class="log"></div>
    </div>
    
    <div class="test-section">
        <h3>Behavior Documentation</h3>
        <div id="behaviorDoc" class="info">
            <p><strong>Instructions:</strong></p>
            <ol>
                <li>Test each tiling type individually</li>
                <li>Document the visual characteristics</li>
                <li>Note any special behaviors or patterns</li>
                <li>Record parameter ranges and effects</li>
            </ol>
        </div>
    </div>

    <script src="lib/tactile.js"></script>
    <script>
        let currentTiling = null;
        let testResults = {};
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.getElementById('testLog');
            const color = type === 'error' ? 'red' : type === 'success' ? 'green' : type === 'warning' ? 'orange' : 'black';
            logDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('testLog').innerHTML = '';
        }
        
        function updateDisplay(tilingType, tiling) {
            document.getElementById('typeDisplay').textContent = tilingType;
            document.getElementById('verticesDisplay').textContent = tiling.numVertices();
            document.getElementById('aspectsDisplay').textContent = tiling.numAspects();
            document.getElementById('edgeShapesDisplay').textContent = tiling.numEdgeShapes();
            
            const params = tiling.getParameters();
            document.getElementById('paramsDisplay').textContent = JSON.stringify(params);
            
            const t1 = tiling.getT1();
            const t2 = tiling.getT2();
            document.getElementById('t1Display').textContent = `(${t1.x.toFixed(3)}, ${t1.y.toFixed(3)})`;
            document.getElementById('t2Display').textContent = `(${t2.x.toFixed(3)}, ${t2.y.toFixed(3)})`;
            
            document.getElementById('canvasInfo').textContent = `Tiling Type: ${tilingType}`;
        }
        
        function drawTiling(tilingType) {
            const canvas = document.getElementById('testCanvas');
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            try {
                // Create tiling
                const tiling = new IsohedralTiling(tilingType);
                currentTiling = tiling;
                
                // Update display
                updateDisplay(tilingType, tiling);
                
                // Simple visualization (we'll enhance this)
                ctx.strokeStyle = 'black';
                ctx.lineWidth = 1;
                ctx.beginPath();
                
                // Draw a simple representation
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const radius = 50;
                
                // Draw vertices
                for (let i = 0; i < tiling.numVertices(); i++) {
                    const vertex = tiling.getVertex(i);
                    const x = centerX + vertex.x * radius;
                    const y = centerY + vertex.y * radius;
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                
                ctx.closePath();
                ctx.stroke();
                
                // Draw vertex points
                ctx.fillStyle = 'red';
                for (let i = 0; i < tiling.numVertices(); i++) {
                    const vertex = tiling.getVertex(i);
                    const x = centerX + vertex.x * radius;
                    const y = centerY + vertex.y * radius;
                    
                    ctx.beginPath();
                    ctx.arc(x, y, 3, 0, 2 * Math.PI);
                    ctx.fill();
                }
                
                log(`✓ Successfully created and drew tiling type ${tilingType}`, 'success');
                
                // Store test result
                testResults[tilingType] = {
                    success: true,
                    vertices: tiling.numVertices(),
                    aspects: tiling.numAspects(),
                    edgeShapes: tiling.numEdgeShapes(),
                    parameters: tiling.getParameters(),
                    t1: tiling.getT1(),
                    t2: tiling.getT2(),
                    timestamp: new Date().toISOString()
                };
                
            } catch (error) {
                log(`✗ Error with tiling type ${tilingType}: ${error.message}`, 'error');
                testResults[tilingType] = {
                    success: false,
                    error: error.message,
                    timestamp: new Date().toISOString()
                };
            }
        }
        
        function testSpecificType() {
            const tilingType = parseInt(document.getElementById('tilingType').value);
            if (tilingType < 1 || tilingType > 37) {
                log(`Invalid tiling type: ${tilingType}. Must be between 1 and 37.`, 'error');
                return;
            }
            
            log(`=== Testing Tiling Type ${tilingType} ===`, 'info');
            drawTiling(tilingType);
        }
        
        function testAllTypes() {
            log('=== Testing All Tiling Types (1-37) ===', 'info');
            
            let successCount = 0;
            let errorCount = 0;
            
            for (let i = 1; i <= 37; i++) {
                try {
                    const tiling = new IsohedralTiling(i);
                    testResults[i] = {
                        success: true,
                        vertices: tiling.numVertices(),
                        aspects: tiling.numAspects(),
                        edgeShapes: tiling.numEdgeShapes(),
                        parameters: tiling.getParameters(),
                        t1: tiling.getT1(),
                        t2: tiling.getT2(),
                        timestamp: new Date().toISOString()
                    };
                    successCount++;
                    log(`✓ Type ${i}: ${tiling.numVertices()} vertices, ${tiling.numAspects()} aspects`, 'success');
                } catch (error) {
                    testResults[i] = {
                        success: false,
                        error: error.message,
                        timestamp: new Date().toISOString()
                    };
                    errorCount++;
                    log(`✗ Type ${i}: ${error.message}`, 'error');
                }
            }
            
            log(`=== Summary: ${successCount} successful, ${errorCount} failed ===`, 'info');
            
            // Save results
            const resultsJson = JSON.stringify(testResults, null, 2);
            const blob = new Blob([resultsJson], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'tiling-test-results.json';
            a.click();
            URL.revokeObjectURL(url);
            
            log('Test results saved to tiling-test-results.json', 'success');
        }
        
        function startServer() {
            log('To start the test server, run: python3 -m http.server 8888', 'info');
            log('Then open: http://localhost:8888/demo/autodemo.html', 'info');
        }
        
        // Initialize with first tiling type
        window.onload = function() {
            log('Test environment loaded. Ready to document tiling behavior.', 'success');
            testSpecificType();
        };
    </script>
</body>
</html>
