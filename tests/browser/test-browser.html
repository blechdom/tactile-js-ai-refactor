<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tactile-JS Safe Refactor - Browser Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success {
            color: #28a745;
            font-weight: bold;
        }
        .error {
            color: #dc3545;
            font-weight: bold;
        }
        .info {
            color: #17a2b8;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        .tiling-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        .tiling-card {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧪 Tactile-JS Safe Refactor - Browser Test</h1>
        <p class="info">Testing the extracted data structures and refactored components in a browser environment.</p>
        
        <div id="loading" class="loading">
            <p>Loading and testing components...</p>
        </div>
        
        <div id="test-results" style="display: none;">
            <!-- Test results will be populated here -->
        </div>
    </div>

    <script type="module">
        // Import the refactored components
        import { TilingDataLoader } from '../../lib/data/TilingDataLoader.js';
        import { EdgeShape } from '../../lib/constants/EdgeShape.js';

        class BrowserTester {
            constructor() {
                this.results = [];
                this.loader = null;
            }

            log(message, type = 'info') {
                console.log(`[${type.toUpperCase()}] ${message}`);
                this.results.push({ message, type, timestamp: new Date().toISOString() });
            }

            async runTests() {
                try {
                    this.log('🚀 Starting browser tests...', 'info');
                    
                    // Test 1: Initialize TilingDataLoader
                    await this.testDataLoaderInitialization();
                    
                    // Test 2: Test data integrity
                    await this.testDataIntegrity();
                    
                    // Test 3: Test tiling type retrieval
                    await this.testTilingTypeRetrieval();
                    
                    // Test 4: Test edge shape functionality
                    await this.testEdgeShapeFunctionality();
                    
                    // Test 5: Test parameter functionality
                    await this.testParameterFunctionality();
                    
                    // Test 6: Performance test
                    await this.testPerformance();
                    
                    this.log('✅ All browser tests completed successfully!', 'success');
                    
                } catch (error) {
                    this.log(`❌ Browser test failed: ${error.message}`, 'error');
                    console.error('Test error:', error);
                } finally {
                    this.displayResults();
                }
            }

            async testDataLoaderInitialization() {
                this.log('Test 1: Initializing TilingDataLoader...', 'info');
                
                this.loader = new TilingDataLoader();
                await this.loader.initialize();
                
                const stats = this.loader.getStatistics();
                this.log(`✅ Initialized with ${stats.totalTilingTypes} tiling types`, 'success');
                
                return stats;
            }

            async testDataIntegrity() {
                this.log('Test 2: Validating data integrity...', 'info');
                
                const issues = this.loader.validateDataIntegrity();
                
                if (issues.length === 0) {
                    this.log('✅ Data integrity validation passed', 'success');
                } else {
                    this.log(`⚠️ Found ${issues.length} data integrity issues`, 'warning');
                    issues.slice(0, 5).forEach(issue => {
                        this.log(`  - ${issue}`, 'warning');
                    });
                }
                
                return issues;
            }

            async testTilingTypeRetrieval() {
                this.log('Test 3: Testing tiling type retrieval...', 'info');
                
                // Test getting a specific tiling type
                const type1 = this.loader.getTilingType(1);
                if (type1) {
                    this.log(`✅ Retrieved tiling type 1: ${type1.name}`, 'success');
                } else {
                    this.log('❌ Failed to retrieve tiling type 1', 'error');
                }
                
                // Test getting all tiling types
                const allTypes = this.loader.getAllTilingTypes();
                this.log(`✅ Retrieved ${allTypes.length} total tiling types`, 'success');
                
                return { type1, allTypes };
            }

            async testEdgeShapeFunctionality() {
                this.log('Test 4: Testing edge shape functionality...', 'info');
                
                const type1 = this.loader.getTilingType(1);
                if (type1) {
                    const edgeShapeCount = type1.edgeShapes ? type1.edgeShapes.length : 0;
                    this.log(`✅ Type 1 has ${edgeShapeCount} edge shapes`, 'success');
                    
                    // Test edge shape constants
                    const edgeShapeTypes = Object.keys(EdgeShape);
                    this.log(`✅ EdgeShape constants available: ${edgeShapeTypes.join(', ')}`, 'success');
                }
                
                return true;
            }

            async testParameterFunctionality() {
                this.log('Test 5: Testing parameter functionality...', 'info');
                
                const type1 = this.loader.getTilingType(1);
                if (type1) {
                    const paramCount = type1.getParameterCount ? type1.getParameterCount() : 'N/A';
                    const vertexCount = type1.getVertexCount ? type1.getVertexCount() : 'N/A';
                    const aspectCount = type1.getAspectCount ? type1.getAspectCount() : 'N/A';
                    
                    this.log(`✅ Type 1 - Params: ${paramCount}, Vertices: ${vertexCount}, Aspects: ${aspectCount}`, 'success');
                }
                
                return true;
            }

            async testPerformance() {
                this.log('Test 6: Running performance test...', 'info');
                
                const startTime = performance.now();
                
                // Test loading all tiling types
                const allTypes = this.loader.getAllTilingTypes();
                
                // Test accessing properties of multiple types
                let totalParams = 0;
                for (const type of allTypes.slice(0, 10)) {
                    totalParams += type.getParameterCount ? type.getParameterCount() : 0;
                }
                
                const endTime = performance.now();
                const duration = (endTime - startTime).toFixed(2);
                
                this.log(`✅ Performance test completed in ${duration}ms`, 'success');
                this.log(`✅ Processed ${allTypes.length} types, total params: ${totalParams}`, 'success');
                
                return { duration, totalParams };
            }

            displayResults() {
                const loadingDiv = document.getElementById('loading');
                const resultsDiv = document.getElementById('test-results');
                
                loadingDiv.style.display = 'none';
                resultsDiv.style.display = 'block';
                
                // Create summary
                const stats = this.loader ? this.loader.getStatistics() : {};
                const successCount = this.results.filter(r => r.type === 'success').length;
                const errorCount = this.results.filter(r => r.type === 'error').length;
                const warningCount = this.results.filter(r => r.type === 'warning').length;
                
                resultsDiv.innerHTML = `
                    <div class="test-section">
                        <h2>📊 Test Summary</h2>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number">${successCount}</div>
                                <div>Successful Tests</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${errorCount}</div>
                                <div>Errors</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${warningCount}</div>
                                <div>Warnings</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${stats.totalTilingTypes || 0}</div>
                                <div>Tiling Types Loaded</div>
                            </div>
                        </div>
                    </div>

                    <div class="test-section">
                        <h2>📋 Test Results</h2>
                        <div id="test-log">
                            ${this.results.map(result => `
                                <div class="${result.type}">
                                    ${result.message}
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="test-section">
                        <h2>📈 Data Statistics</h2>
                        <pre>${JSON.stringify(stats, null, 2)}</pre>
                    </div>

                    <div class="test-section">
                        <h2>🎯 Sample Tiling Types</h2>
                        <div class="tiling-preview" id="tiling-preview">
                            <!-- Will be populated with tiling type samples -->
                        </div>
                    </div>
                `;

                // Add sample tiling types
                this.displaySampleTilingTypes();
            }

            displaySampleTilingTypes() {
                if (!this.loader) return;
                
                const previewDiv = document.getElementById('tiling-preview');
                const allTypes = this.loader.getAllTilingTypes();
                const sampleTypes = allTypes.slice(0, 12); // Show first 12 types
                
                previewDiv.innerHTML = sampleTypes.map(type => `
                    <div class="tiling-card">
                        <strong>${type.name || `Type ${type.id}`}</strong><br>
                        <small>
                            Params: ${type.getParameterCount ? type.getParameterCount() : 'N/A'}<br>
                            Vertices: ${type.getVertexCount ? type.getVertexCount() : 'N/A'}<br>
                            Edges: ${type.edgeShapes ? type.edgeShapes.length : 'N/A'}
                        </small>
                    </div>
                `).join('');
            }
        }

        // Run the tests when the page loads
        window.addEventListener('load', async () => {
            const tester = new BrowserTester();
            await tester.runTests();
        });

        // Make tester available globally for debugging
        window.tactileTester = new BrowserTester();
    </script>
</body>
</html>
